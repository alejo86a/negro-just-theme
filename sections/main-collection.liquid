{% comment %}
  Main Collection Page Section
{% endcomment %}

{%- liquid
  comment
    In collection template, Shopify automatically provides the collection object
    If collection is not available, try to get it from section settings
  endcomment
  if collection == blank and section.settings.collection != blank
    assign collection = collections[section.settings.collection]
  endif
  assign products_per_page = section.settings.products_per_page | default: 24
-%}

<div class="collection-page color-{{ section.settings.color_scheme }}" id="CollectionSection-{{ section.id }}" data-section-id="{{ section.id }}">
  {%- comment -%} Collection Hero Banner {%- endcomment -%}
  <div class="collection-hero">
    {%- if collection.featured_image != blank -%}
      <div class="collection-hero__background">
        <img
          srcset="{%- if collection.featured_image.width >= 375 -%}{{ collection.featured_image | image_url: width: 375 }} 375w,{%- endif -%}
                  {%- if collection.featured_image.width >= 750 -%}{{ collection.featured_image | image_url: width: 750 }} 750w,{%- endif -%}
                  {%- if collection.featured_image.width >= 1100 -%}{{ collection.featured_image | image_url: width: 1100 }} 1100w,{%- endif -%}
                  {%- if collection.featured_image.width >= 1500 -%}{{ collection.featured_image | image_url: width: 1500 }} 1500w,{%- endif -%}
                  {{ collection.featured_image | image_url }} {{ collection.featured_image.width }}w"
          src="{{ collection.featured_image | image_url: width: 1500 }}"
          sizes="100vw"
          alt="{{ collection.title | escape }}"
          loading="eager"
          width="{{ collection.featured_image.width }}"
          height="{{ collection.featured_image.height }}"
          class="collection-hero__image"
        >
      </div>
    {%- endif -%}
    <div class="collection-hero__overlay"></div>
    <div class="collection-hero__content page-width">
      {%- if collection != blank -%}
        <h1 class="collection-hero__title h0">{{ collection.title | escape }}</h1>
        {%- if collection.description != blank -%}
          <div class="collection-hero__description">
            {{ collection.description }}
          </div>
        {%- endif -%}
      {%- endif -%}
    </div>
    <div class="collection-hero__ripped-edge"></div>
  </div>

  <div class="collection-page__wrapper page-width">
    {%- comment -%} Mobile Filter Button {%- endcomment -%}
    <button type="button" class="collection-filters__mobile-trigger" aria-label="{{ 'collections.filters.filter_and_sort' | t }}" data-filter-trigger>
      <span>{{ 'collections.filters.filter_and_sort' | t }}</span>
    </button>

    <div class="collection-page__layout">
      {%- comment -%} Sidebar Filters {%- endcomment -%}
      <aside class="collection-filters" data-filters>
        <div class="collection-filters__header">
          <h2 class="collection-filters__title">{{ 'collections.filters.filter_by' | t }}</h2>
          <button type="button" class="collection-filters__close" aria-label="{{ 'collections.filters.close' | t }}" data-filter-close>
            <span class="visually-hidden">{{ 'collections.filters.close' | t }}</span>
            Ã—
          </button>
        </div>

        <form class="collection-filters__form" data-filter-form>
          {%- comment -%} Availability Filter {%- endcomment -%}
          <div class="collection-filters__group">
            <button type="button" class="collection-filters__accordion" data-accordion-trigger aria-expanded="true">
              <span>{{ 'collections.filters.availability' | t }}</span>
              <span class="collection-filters__accordion-icon">+</span>
            </button>
            <div class="collection-filters__accordion-content" data-accordion-content>
              <div class="collection-filters__checkbox">
                <input type="checkbox" id="filter-available-{{ section.id }}" name="filter" value="available" data-filter-checkbox>
                <label for="filter-available-{{ section.id }}">{{ 'collections.filters.in_stock' | t }}</label>
              </div>
              <div class="collection-filters__checkbox">
                <input type="checkbox" id="filter-out-of-stock-{{ section.id }}" name="filter" value="out-of-stock" data-filter-checkbox>
                <label for="filter-out-of-stock-{{ section.id }}">{{ 'collections.filters.out_of_stock' | t }}</label>
              </div>
            </div>
          </div>

          {%- comment -%} Price Filter {%- endcomment -%}
          <div class="collection-filters__group">
            <button type="button" class="collection-filters__accordion" data-accordion-trigger aria-expanded="true">
              <span>{{ 'collections.filters.price' | t }}</span>
              <span class="collection-filters__accordion-icon">+</span>
            </button>
            <div class="collection-filters__accordion-content" data-accordion-content>
              <div class="collection-filters__checkbox">
                <input type="checkbox" id="filter-price-low-{{ section.id }}" name="filter" value="price-low" data-filter-checkbox>
                <label for="filter-price-low-{{ section.id }}">{{ 'collections.filters.under_50' | t }}</label>
              </div>
              <div class="collection-filters__checkbox">
                <input type="checkbox" id="filter-price-medium-{{ section.id }}" name="filter" value="price-medium" data-filter-checkbox>
                <label for="filter-price-medium-{{ section.id }}">{{ 'collections.filters.50_to_100' | t }}</label>
              </div>
              <div class="collection-filters__checkbox">
                <input type="checkbox" id="filter-price-high-{{ section.id }}" name="filter" value="price-high" data-filter-checkbox>
                <label for="filter-price-high-{{ section.id }}">{{ 'collections.filters.over_100' | t }}</label>
              </div>
            </div>
          </div>

          {%- comment -%} Sort Options {%- endcomment -%}
          <div class="collection-filters__group">
            <label class="collection-filters__label" for="SortBy-{{ section.id }}">{{ 'collections.sorting.title' | t }}</label>
            <div class="select">
              <select name="sort_by" id="SortBy-{{ section.id }}" class="select__select" data-sort-select>
                <option value="manual" {% if collection.sort_by == 'manual' %}selected="selected"{% endif %}>{{ 'collections.sorting.featured' | t }}</option>
                <option value="best-selling" {% if collection.sort_by == 'best-selling' %}selected="selected"{% endif %}>{{ 'collections.sorting.best_selling' | t }}</option>
                <option value="title-ascending" {% if collection.sort_by == 'title-ascending' %}selected="selected"{% endif %}>{{ 'collections.sorting.az' | t }}</option>
                <option value="title-descending" {% if collection.sort_by == 'title-descending' %}selected="selected"{% endif %}>{{ 'collections.sorting.za' | t }}</option>
                <option value="price-ascending" {% if collection.sort_by == 'price-ascending' %}selected="selected"{% endif %}>{{ 'collections.sorting.price_ascending' | t }}</option>
                <option value="price-descending" {% if collection.sort_by == 'price-descending' %}selected="selected"{% endif %}>{{ 'collections.sorting.price_descending' | t }}</option>
                <option value="created-ascending" {% if collection.sort_by == 'created-ascending' %}selected="selected"{% endif %}>{{ 'collections.sorting.date_ascending' | t }}</option>
                <option value="created-descending" {% if collection.sort_by == 'created-descending' %}selected="selected"{% endif %}>{{ 'collections.sorting.date_descending' | t }}</option>
              </select>
            </div>
          </div>

          <button type="button" class="collection-filters__clear button button--secondary" data-filter-clear>{{ 'collections.filters.clear_all' | t }}</button>
        </form>
      </aside>

      {%- comment -%} Product Grid Area {%- endcomment -%}
      <div class="collection-products">
        {%- if collection != blank and collection.products_count > 0 -%}
          {%- paginate collection.products by products_per_page -%}
            <div class="collection-products__grid grid grid--4-col-desktop grid--3-col-tablet grid--2-col-mobile" data-product-grid>
              {%- for product in collection.products -%}
                {% render 'product-card', product: product %}
              {%- endfor -%}
            </div>

            {%- comment -%} Load More Button {%- endcomment -%}
            {%- if paginate.pages > 1 -%}
              <div class="collection-products__load-more" data-load-more-container>
                <button type="button" class="collection-products__load-more-button button button--secondary" data-load-more data-next-page="{% if paginate.next %}{{ paginate.next.url }}{% endif %}">
                  {{ 'collections.load_more' | t }}
                </button>
              </div>
            {%- endif -%}
          {%- endpaginate -%}
        {%- else -%}
          {%- comment -%} Empty State {%- endcomment -%}
          <div class="collection-products__empty">
            <p class="collection-products__empty-message">{{ 'collections.empty.message' | t }}</p>
            <a href="{{ routes.root_url }}" class="button button--primary">{{ 'collections.empty.back_to_home' | t }}</a>
          </div>
        {%- endif -%}
      </div>
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Collection",
  "tag": "section",
  "class": "section-main-collection",
  "settings": [
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    },
    {
      "type": "range",
      "id": "products_per_page",
      "min": 8,
      "max": 50,
      "step": 4,
      "default": 24,
      "label": "Products per page"
    },
    {
      "type": "select",
      "id": "color_scheme",
      "options": [
        {
          "value": "accent-1",
          "label": "Accent 1"
        },
        {
          "value": "accent-2",
          "label": "Accent 2"
        },
        {
          "value": "background-1",
          "label": "Background 1"
        },
        {
          "value": "background-2",
          "label": "Background 2"
        },
        {
          "value": "inverse",
          "label": "Inverse"
        }
      ],
      "default": "background-1",
      "label": "Color scheme"
    }
  ],
  "presets": [
    {
      "name": "Collection"
    }
  ]
}
{% endschema %}

